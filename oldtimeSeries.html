<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lemon Oldtime Series Banjos</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" type="image/png" href="assets/favicon.png">
</head>
<body>
  <div id="header"></div>

  <section class="section">
    <div class="container narrow">
      <h1 class="section-title">Oldtime Series Banjos</h1>
      <p class="text-center">
        The Lemon Oldtime Series is a line of open back banjos, excellent for use in old-time and folk music!
      </p>
    </div>
  </section>

  <section class="section">
  <div class="container">
    <!-- NOTE: no hard-coded cards here either -->
    <div
      class="card-grid"
      data-series-prefix="OLDTIME"
      data-image-root="assets/product_images/oldtime">
	  <div class="loading-message">Tuning banjos...</div>
   </div>
  </div>
</section>

  <div id="footer"></div>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      // --- Tiny GViz helpers just for this page ---
      const SHEET_ID = '1JaKOJLDKDgEvIg54UKKg2J3fftwOsZlKBw1j5qjeheU';

      const GVIZ = (sheet, tq) =>
        'https://corsproxy.io/?' +
        'https://docs.google.com/spreadsheets/d/' + SHEET_ID + '/gviz/tq?' +
        new URLSearchParams({ sheet, tq }).toString();

      const rows = t => (t?.rows || []).map(r => (r.c || []).map(c => c?.v ?? null));

      const fmtUSD = n =>
        new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' })
          .format(Number(n) || 0);

      // --- Grab all cards that declare a model key ---
      const cards = Array.from(document.querySelectorAll('.card[data-model-key]'));
      if (!cards.length) return;

      const keys = [...new Set(cards.map(c => c.dataset.modelKey.toUpperCase()))];
      const whereClause = keys.map(k => `A='${k}'`).join(' or ');

      try {
        const res = await fetch(
          GVIZ('Products', `select A,D where ${whereClause}`),
          { cache: 'no-store' }
        );
        const txt = await res.text();
        const json = JSON.parse(txt.substring(47).slice(0, -2));
        const table = json.table;
        const data = rows(table);

        const priceByKey = {};
        data.forEach(([key, base]) => {
          if (!key) return;
          priceByKey[String(key).trim().toUpperCase()] = Number(base || 0);
        });

        cards.forEach(card => {
          const key = card.dataset.modelKey.toUpperCase();
          const price = priceByKey[key];
          const el = card.querySelector('.card-price');
          if (!el) return;

          if (price != null) {
            el.textContent = 'Starting at ' + fmtUSD(price);
          } else {
            el.textContent = ''; // or 'Price TBA'
          }
        });
      } catch (err) {
        console.error('Error loading legacy card prices', err);
      }
    });
  </script>

  <script>
	  function initHeaderFooter() {
		return Promise.all([
		  fetch('header.html').then(r => r.text()).then(h => {
			document.getElementById('header').innerHTML = h;
		  }),
		  fetch('footer.html').then(r => r.text()).then(f => {
			document.getElementById('footer').innerHTML = f;
		  })
		]).then(() => {
		  // this runs AFTER header/footer are in the DOM
		  const toggle = document.getElementById('menu-toggle');
		  const nav = document.getElementById('main-nav');
		  if (toggle && nav) {
			toggle.addEventListener('click', () => {
			  const isOpen = nav.classList.toggle('open');
			  toggle.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
			});
		  }
		});
	  }

	  initHeaderFooter().catch(console.error);
	</script>
<script src="assets/js/seriesCards.js"></script>
<script>
  initHeaderFooter().catch(console.error);
</script>
</body>
</html>
